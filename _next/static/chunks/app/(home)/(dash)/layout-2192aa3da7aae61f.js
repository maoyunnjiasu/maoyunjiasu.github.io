(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[774],{35695:(t,e,a)=>{"use strict";var r=a(18999);a.o(r,"usePathname")&&a.d(e,{usePathname:function(){return r.usePathname}}),a.o(r,"useRouter")&&a.d(e,{useRouter:function(){return r.useRouter}}),a.o(r,"useSearchParams")&&a.d(e,{useSearchParams:function(){return r.useSearchParams}})},59568:(t,e,a)=>{"use strict";a.d(e,{A:()=>d,O:()=>c});var r=a(95155),s=a(23464),o=a(12115),n=a(60838),u=a(792);let i=(0,o.createContext)(void 0),c=t=>{let{children:e}=t,[a,c]=(0,o.useState)(()=>{let t=localStorage.getItem("auth_data");return{isAuthChecked:!!t,isLoggedIn:!!t}}),[d,h]=(0,o.useState)(),[l,g]=(0,o.useState)();(0,o.useEffect)(()=>{if(!window.settings)return;let{title:t,description:e}=window.settings;document.title="".concat(t," - ").concat(e),window.settings.crisp_id&&u.YH.configure(window.settings.crisp_id),h(window.settings)},[]);let f=(0,o.useMemo)(()=>{if(!d)return;let{api:t}=d,e=s.A.create({baseURL:new URL("/api/v1",t).toString(),timeout:1e4,headers:{"Content-Type":"application/json"}});return e.interceptors.request.use(t=>{let e=localStorage.getItem("auth_data");return e&&(t.headers.Authorization=e),t}),e.interceptors.response.use(t=>t,t=>{var e;return(null==(e=t.response)?void 0:e.status)===403&&(localStorage.removeItem("auth_data"),c(t=>({...t,isLoggedIn:!1}))),Promise.reject(t)}),c(t=>({...t,isAuthChecked:!0})),e},[d]),m=(0,o.useCallback)(async t=>{if(!f)return;let{data:e}=await f.get(t);return e},[f]);(0,o.useEffect)(()=>{f&&localStorage.getItem("auth_data")&&(async()=>{try{await f.get("user/checkLogin"),c(t=>({...t,isLoggedIn:!0}))}catch(t){console.error("Failed to check session:",t)}})()},[f]);let p=(0,o.useCallback)(async()=>{if(f&&!l)try{let t=await f.get("guest/comm/config");g(t.data.data)}catch(t){console.error("Failed to load remote config:",t)}},[f,l]),w=async(t,e)=>{if(f)try{let{data:a}=await f.post("passport/auth/login",{email:t,password:e});localStorage.setItem("auth_data",a.data.auth_data),c(t=>({...t,isLoggedIn:!0}))}catch(t){throw t}},y=async(t,e,a,r)=>{if(f)try{let{data:s}=await f.post("passport/auth/register",{email:t,password:e,email_code:a,invite_code:r});localStorage.setItem("auth_data",s.data.auth_data),c(t=>({...t,isLoggedIn:!0}))}catch(t){throw t}},_=async(t,e,a)=>{if(f)try{await f.post("passport/auth/forget",{email:t,password:e,email_code:a})}catch(t){throw t}},v=async t=>{if(f)try{await f.post("passport/comm/sendEmailVerify",{email:t})}catch(t){throw t}};return(0,r.jsx)(i.Provider,{value:{isAuthChecked:a.isAuthChecked,isLoggedIn:a.isLoggedIn,request:f,config:d,remoteConfig:l,loadRemoteConfig:p,signIn:w,signUp:y,signOut:()=>{localStorage.removeItem("auth_data"),c({isAuthChecked:!0,isLoggedIn:!1})},sendVerifyCode:v,resetPassword:_},children:(0,r.jsx)(n.BE,{value:{fetcher:m,errorRetryCount:1,errorRetryInterval:100},children:e})})},d=()=>{let t=(0,o.useContext)(i);if(void 0===t)throw Error("useAuth must be used within an AuthProvider");return t}},60683:(t,e,a)=>{Promise.resolve().then(a.bind(a,80312))},80312:(t,e,a)=>{"use strict";a.r(e),a.d(e,{default:()=>n});var r=a(59568),s=a(35695),o=a(12115);function n(t){let{children:e}=t,{isAuthChecked:a,isLoggedIn:n}=(0,r.A)(),u=(0,s.useRouter)();return((0,o.useEffect)(()=>{a&&!n&&u.push("/signin")},[a,n]),a&&n)?e:null}}},t=>{t.O(0,[84,441,964,358],()=>t(t.s=60683)),_N_E=t.O()}]);