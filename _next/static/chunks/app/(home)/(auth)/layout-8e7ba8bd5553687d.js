(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[548],{35695:(e,t,a)=>{"use strict";var r=a(18999);a.o(r,"usePathname")&&a.d(t,{usePathname:function(){return r.usePathname}}),a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}}),a.o(r,"useSearchParams")&&a.d(t,{useSearchParams:function(){return r.useSearchParams}})},42102:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>n});var r=a(59568),s=a(35695),o=a(12115);function n(e){let{children:t}=e,{isAuthChecked:a,isLoggedIn:n}=(0,r.A)(),u=(0,s.useRouter)();return((0,o.useEffect)(()=>{a&&n&&u.push("/profile")},[a,n,u]),!a||n)?null:t}},59568:(e,t,a)=>{"use strict";a.d(t,{A:()=>d,O:()=>c});var r=a(95155),s=a(23464),o=a(12115),n=a(60838),u=a(792);let i=(0,o.createContext)(void 0),c=e=>{let{children:t}=e,[a,c]=(0,o.useState)(()=>{let e=localStorage.getItem("auth_data");return{isAuthChecked:!!e,isLoggedIn:!!e}}),[d,l]=(0,o.useState)(),[h,g]=(0,o.useState)();(0,o.useEffect)(()=>{if(!window.settings)return;let{title:e,description:t}=window.settings;document.title="".concat(e," - ").concat(t),window.settings.crisp_id&&u.YH.configure(window.settings.crisp_id),l(window.settings)},[]);let f=(0,o.useMemo)(()=>{if(!d)return;let{api:e}=d,t=s.A.create({baseURL:new URL("/api/v1",e).toString(),timeout:1e4,headers:{"Content-Type":"application/json"}});return t.interceptors.request.use(e=>{let t=localStorage.getItem("auth_data");return t&&(e.headers.Authorization=t),e}),t.interceptors.response.use(e=>e,e=>{var t;return(null==(t=e.response)?void 0:t.status)===403&&(localStorage.removeItem("auth_data"),c(e=>({...e,isLoggedIn:!1}))),Promise.reject(e)}),c(e=>({...e,isAuthChecked:!0})),t},[d]),m=(0,o.useCallback)(async e=>{if(!f)return;let{data:t}=await f.get(e);return t},[f]);(0,o.useEffect)(()=>{f&&localStorage.getItem("auth_data")&&(async()=>{try{await f.get("user/checkLogin"),c(e=>({...e,isLoggedIn:!0}))}catch(e){console.error("Failed to check session:",e)}})()},[f]);let p=(0,o.useCallback)(async()=>{if(f&&!h)try{let e=await f.get("guest/comm/config");g(e.data.data)}catch(e){console.error("Failed to load remote config:",e)}},[f,h]),w=async(e,t)=>{if(f)try{let{data:a}=await f.post("passport/auth/login",{email:e,password:t});localStorage.setItem("auth_data",a.data.auth_data),c(e=>({...e,isLoggedIn:!0}))}catch(e){throw e}},y=async(e,t,a,r)=>{if(f)try{let{data:s}=await f.post("passport/auth/register",{email:e,password:t,email_code:a,invite_code:r});localStorage.setItem("auth_data",s.data.auth_data),c(e=>({...e,isLoggedIn:!0}))}catch(e){throw e}},_=async(e,t,a)=>{if(f)try{await f.post("passport/auth/forget",{email:e,password:t,email_code:a})}catch(e){throw e}},v=async e=>{if(f)try{await f.post("passport/comm/sendEmailVerify",{email:e})}catch(e){throw e}};return(0,r.jsx)(i.Provider,{value:{isAuthChecked:a.isAuthChecked,isLoggedIn:a.isLoggedIn,request:f,config:d,remoteConfig:h,loadRemoteConfig:p,signIn:w,signUp:y,signOut:()=>{localStorage.removeItem("auth_data"),c({isAuthChecked:!0,isLoggedIn:!1})},sendVerifyCode:v,resetPassword:_},children:(0,r.jsx)(n.BE,{value:{fetcher:m,errorRetryCount:1,errorRetryInterval:100},children:t})})},d=()=>{let e=(0,o.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},74009:(e,t,a)=>{Promise.resolve().then(a.bind(a,42102))}},e=>{e.O(0,[84,441,964,358],()=>e(e.s=74009)),_N_E=e.O()}]);