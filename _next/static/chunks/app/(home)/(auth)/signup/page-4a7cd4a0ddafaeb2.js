(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[732],{35695:(e,t,a)=>{"use strict";var s=a(18999);a.o(s,"usePathname")&&a.d(t,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}}),a.o(s,"useSearchParams")&&a.d(t,{useSearchParams:function(){return s.useSearchParams}})},54601:(e,t,a)=>{Promise.resolve().then(a.bind(a,75750))},59568:(e,t,a)=>{"use strict";a.d(t,{A:()=>d,O:()=>u});var s=a(95155),r=a(23464),i=a(12115),l=a(60838),n=a(792);let o=(0,i.createContext)(void 0),u=e=>{let{children:t}=e,[a,u]=(0,i.useState)(()=>{let e=localStorage.getItem("auth_data");return{isAuthChecked:!!e,isLoggedIn:!!e}}),[d,c]=(0,i.useState)(),[m,h]=(0,i.useState)();(0,i.useEffect)(()=>{if(!window.settings)return;let{title:e,description:t}=window.settings;document.title="".concat(e," - ").concat(t),window.settings.crisp_id&&n.YH.configure(window.settings.crisp_id),c(window.settings)},[]);let f=(0,i.useMemo)(()=>{if(!d)return;let{api:e}=d,t=r.A.create({baseURL:new URL("/api/v1",e).toString(),timeout:1e4,headers:{"Content-Type":"application/json"}});return t.interceptors.request.use(e=>{let t=localStorage.getItem("auth_data");return t&&(e.headers.Authorization=t),e}),t.interceptors.response.use(e=>e,e=>{var t;return(null==(t=e.response)?void 0:t.status)===403&&(localStorage.removeItem("auth_data"),u(e=>({...e,isLoggedIn:!1}))),Promise.reject(e)}),u(e=>({...e,isAuthChecked:!0})),t},[d]),p=(0,i.useCallback)(async e=>{if(!f)return;let{data:t}=await f.get(e);return t},[f]);(0,i.useEffect)(()=>{f&&localStorage.getItem("auth_data")&&(async()=>{try{await f.get("user/checkLogin"),u(e=>({...e,isLoggedIn:!0}))}catch(e){console.error("Failed to check session:",e)}})()},[f]);let g=(0,i.useCallback)(async()=>{if(f&&!m)try{let e=await f.get("guest/comm/config");h(e.data.data)}catch(e){console.error("Failed to load remote config:",e)}},[f,m]),v=async(e,t)=>{if(f)try{let{data:a}=await f.post("passport/auth/login",{email:e,password:t});localStorage.setItem("auth_data",a.data.auth_data),u(e=>({...e,isLoggedIn:!0}))}catch(e){throw e}},x=async(e,t,a,s)=>{if(f)try{let{data:r}=await f.post("passport/auth/register",{email:e,password:t,email_code:a,invite_code:s});localStorage.setItem("auth_data",r.data.auth_data),u(e=>({...e,isLoggedIn:!0}))}catch(e){throw e}},w=async(e,t,a)=>{if(f)try{await f.post("passport/auth/forget",{email:e,password:t,email_code:a})}catch(e){throw e}},b=async e=>{if(f)try{await f.post("passport/comm/sendEmailVerify",{email:e})}catch(e){throw e}};return(0,s.jsx)(o.Provider,{value:{isAuthChecked:a.isAuthChecked,isLoggedIn:a.isLoggedIn,request:f,config:d,remoteConfig:m,loadRemoteConfig:g,signIn:v,signUp:x,signOut:()=>{localStorage.removeItem("auth_data"),u({isAuthChecked:!0,isLoggedIn:!1})},sendVerifyCode:b,resetPassword:w},children:(0,s.jsx)(l.BE,{value:{fetcher:p,errorRetryCount:1,errorRetryInterval:100},children:t})})},d=()=>{let e=(0,i.useContext)(o);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},75750:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>p});var s=a(95155),r=a(59568),i=a(90996),l=a(66749),n=a(74369),o=a(65701),u=a(40933),d=a(99010),c=a(66069),m=a(35695),h=a(12115),f=a(56671);function p(){var e;let t=(0,m.useSearchParams)(),{signUp:a,remoteConfig:p,loadRemoteConfig:g,sendVerifyCode:v}=(0,r.A)(),x=(0,h.useRef)(null);(0,h.useEffect)(()=>{p||g()},[p]);let[w,b]=(0,h.useState)({email:"",timer:-1,isVisible:!1,isVisible1:!1}),y=async()=>{if(!w.email||!w.email.split("@")[0])return f.oR.error("邮箱不能为空");try{await v(w.email),f.oR.success("验证码已发送，请注意查收"),b(e=>({...e,timer:60}))}catch(e){(0,i.A)(e)}},[j,C]=(0,h.useState)(!1);return p?(0,s.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,s.jsxs)("div",{className:"flex w-full max-w-sm flex-col gap-4 rounded-large px-8 pb-10 pt-6",children:[(0,s.jsxs)("p",{className:"pb-4 text-center text-3xl font-semibold",children:["欢迎使用",(0,s.jsx)("span",{"aria-label":"emoji",className:"ml-2",role:"img",children:"\uD83D\uDC4B"})]}),(0,s.jsxs)(l.l,{className:"flex flex-col gap-4",validationBehavior:"native",onSubmit:e=>{e.preventDefault(),f.oR.promise(async()=>{if(!p)return;let t=e.currentTarget;try{var s,r;if(C(!0),t.password.value!==t.password1.value)throw Error("两次输入的密码不一致");await a(w.email,t.password.value,(null==(s=t.verifyCode)?void 0:s.value)||"",(null==(r=t.inviteCode)?void 0:r.value)||"")}catch(e){throw e}finally{C(!1)}},{loading:"注册中...",error:i.A})},children:[Array.isArray(p.email_whitelist_suffix)?(0,s.jsx)(n.r,{autoComplete:"username",isRequired:!0,label:"邮箱",name:"email",placeholder:"请输入您的邮箱",type:"text",variant:"bordered",radius:"full",value:w.email.split("@")[0],onValueChange:e=>{var t,a;if(null===x.current)return;let s=e,r=(null==(t=x.current)?void 0:t.value)||"";if(e.includes("@")&&(s=e.split("@")[0]),/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)){let t=e.split("@");s=t[0],r=t[1],(null==p?void 0:p.email_whitelist_suffix).includes(r)?x.current.value=r:r=(null==(a=x.current)?void 0:a.value)||""}b(e=>({...e,email:"".concat(s,"@").concat(r)}))},endContent:(0,s.jsxs)("div",{className:"flex items-center text-small",children:[(0,s.jsx)("label",{className:"text-default-500",children:"@"}),(0,s.jsx)("select",{className:"outline-none border-0 text-default-500 bg-background",id:"emailSuffix",name:"emailSuffix",ref:x,onChange:e=>b({...w,email:w.email.split("@")[0]+"@"+e.target.value}),children:null==p?void 0:p.email_whitelist_suffix.map(e=>(0,s.jsx)("option",{value:e,className:"text-black",children:e},e))})]})}):(0,s.jsx)(n.r,{autoComplete:"username",isRequired:!0,label:"邮箱",name:"email",placeholder:"请输入您的邮箱",type:"email",variant:"bordered",radius:"full",value:w.email,onValueChange:e=>b(t=>({...t,email:e}))}),1===p.is_email_verify&&(0,s.jsx)(n.r,{autoComplete:"off",isRequired:!0,label:"验证码",name:"verifyCode",placeholder:"点击发送后查看邮箱",type:"text",variant:"bordered",radius:"full",endContent:(0,s.jsx)(o.T,{radius:"full",color:"primary",className:"h-full",isLoading:w.timer>0,spinner:null,onPress:y,children:w.timer<=0?"发送":w.timer.toString()})}),(0,s.jsx)(n.r,{autoComplete:"new-password",isRequired:!0,endContent:(0,s.jsx)("button",{type:"button",onClick:()=>b(e=>({...e,isVisible:!e.isVisible})),children:w.isVisible?(0,s.jsx)(d.A,{weight:"Linear",size:24,className:"text-default-500"}):(0,s.jsx)(c.A,{weight:"Bold",size:24,className:"text-default-500"})}),label:"密码",name:"password",placeholder:"请输入您的密码",type:w.isVisible?"text":"password",variant:"bordered",radius:"full"}),(0,s.jsx)(n.r,{autoComplete:"new-password",isRequired:!0,endContent:(0,s.jsx)("button",{type:"button",onClick:()=>b(e=>({...e,isVisible1:!e.isVisible1})),children:w.isVisible1?(0,s.jsx)(d.A,{weight:"Linear",size:24,className:"text-default-500"}):(0,s.jsx)(c.A,{weight:"Bold",size:24,className:"text-default-500"})}),label:"再次输入密码",name:"password1",placeholder:"请再次输入您的密码",type:w.isVisible1?"text":"password",variant:"bordered",radius:"full"}),(0,s.jsx)(n.r,{isRequired:1===p.is_invite_force,label:"邀请码",name:"inviteCode",placeholder:"请输入邀请码"+(1===p.is_invite_force?"":"（选填）"),type:"text",variant:"bordered",radius:"full",defaultValue:null!=(e=t.get("code"))?e:"",isReadOnly:null!==t.get("code")}),(0,s.jsx)("div",{className:"flex w-full items-center justify-between px-1 py-2",children:(0,s.jsx)(u.h,{href:"/signin",size:"sm",children:"返回登录"})}),(0,s.jsx)(o.T,{className:"w-full",color:"primary",type:"submit",radius:"full",isLoading:j,children:!j&&"注册"})]})]})}):null}},90996:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});var s=a(23464);let r=e=>{if(s.A.isAxiosError(e))if(!e.response)return"网络错误，请尝试更换浏览器或者网络环境后再试";else{var t;let a=null==(t=e.response)?void 0:t.data;if(a.message)return a.message}return e instanceof Error?e.message:"未知错误"}}},e=>{e.O(0,[84,876,895,330,671,369,406,441,964,358],()=>e(e.s=54601)),_N_E=e.O()}]);